<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Malla Curricular Interactiva 葛</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #e6d7f2; /* lila pastel */
      margin: 20px;
      color: #4a3c68;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      color: #5b2e7d; /* morado fuerte */
      font-weight: 700;
      margin-bottom: 30px;
      user-select: none;
    }
    /* Contenedor horizontal por semestres */
    #contenedor {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding-bottom: 20px;
    }
    /* Cada semestre como columna */
    .semestre {
      background: #f9f2fc; /* rosa muy pastel */
      border-radius: 16px;
      box-shadow: 0 6px 12px rgba(91, 46, 125, 0.15);
      padding: 20px;
      min-width: 280px;
      flex-shrink: 0;
      position: relative;
      border: 2px solid #c8a4e7;
    }
    .semestre h2 {
      text-align: center;
      margin-bottom: 15px;
      font-size: 1.4rem;
      user-select: none;
    }
    /* Sticker decorativo arriba derecha */
    .sticker {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.8rem;
      user-select: none;
      pointer-events: none;
      opacity: 0.5;
    }
    /* Ramo */
    .ramo {
      background: #ffffffcc;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin: 10px 0;
      padding: 12px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s ease, border-left-color 0.3s ease;
      border-left: 8px solid #a1cfff; /* azul pastel por defecto */
      user-select: none;
      cursor: default;
    }
    .ramo.cursado {
      /* No tachar, solo bajamos opacidad y cambia borde */
      opacity: 0.7;
      border-left-color: #8fc77b; /* verde pastel para aprobado */
      cursor: default;
    }
    .ramo.reprobado {
      border-left-color: #f77;
      opacity: 0.9;
    }
    .ramo.examen {
      border-left-color: #f7c677;
      opacity: 0.7;
    }
    .ramo.eximido {
      border-left-color: #8fc77b;
      opacity: 0.7;
    }
    /* Nombre del ramo */
    label {
      flex: 1;
      padding-right: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      user-select: text;
    }
    /* Input de nota */
    input[type="number"] {
      width: 50px;
      padding: 6px 8px;
      font-size: 1rem;
      border: 2px solid #c8a4e7;
      border-radius: 10px;
      text-align: center;
      transition: border-color 0.3s ease;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: #5b2e7d;
      background-color: #f3e9ff;
    }
    /* Input deshabilitado */
    input[disabled] {
      background-color: #eee;
      cursor: not-allowed;
      color: #aaa;
      border-color: #ddd;
    }
    /* Hover para ramo habilitado */
    .ramo:not(.bloqueado):hover {
      background-color: #f6e7ff;
      box-shadow: 0 6px 12px rgba(91, 46, 125, 0.3);
    }
    /* Etiquetas de estado al lado del input */
    .estado {
      margin-left: 10px;
      font-weight: 700;
      font-size: 0.9rem;
      font-family: monospace;
      user-select: none;
      min-width: 70px;
      text-align: center;
      border-radius: 8px;
      padding: 4px 6px;
      color: white;
    }
    .reprobado .estado {
      background-color: #e04c4c;
    }
    .examen .estado {
      background-color: #d6b32b;
    }
    .eximido .estado {
      background-color: #3ca34d;
    }
    .cursado:not(.reprobado):not(.examen):not(.eximido) .estado {
      background-color: #3ca34d;
    }
  </style>
</head>
<body>
  <h1> Malla Curricular Interactiva 葛</h1>
  <div id="contenedor"></div>

  <script>
    const ramos = [
      { nombre: "Introducci贸n a la contabilidad", semestre: 1, abre: ["Contabilidad financiera"] },
      { nombre: "Normativa empresarial I", semestre: 1, abre: ["Normativa empresarial II"] },
      { nombre: "Gesti贸n de organizaciones I", semestre: 1, abre: ["Gesti贸n de organizaciones II"] },
      { nombre: "Lengua materna y autorregulaci贸n", semestre: 1 },
      { nombre: "Matem谩ticas I", semestre: 1, abre: ["Matem谩ticas II", "Econom铆a I"] },

      { nombre: "Contabilidad financiera", semestre: 2, requiere: ["Introducci贸n a la contabilidad"], abre: ["Normativa contable IFRS"] },
      { nombre: "Normativa empresarial II", semestre: 2, requiere: ["Normativa empresarial I"], abre: ["Normativa tributaria"] },
      { nombre: "Gesti贸n de organizaciones II", semestre: 2, requiere: ["Gesti贸n de organizaciones I"], abre: ["Gesti贸n de capital humano", "Gesti贸n comercial"] },
      { nombre: "Introducci贸n a la auditor铆a", semestre: 2, abre: ["Control interno y gesti贸n de riesgos"] },
      { nombre: "Econom铆a I", semestre: 2, requiere: ["Matem谩ticas I"], abre: ["Econom铆a II", "Costos para la toma de decisiones I"] },
      { nombre: "Matem谩ticas II", semestre: 2, requiere: ["Matem谩ticas I"], abre: ["Estad铆stica"] },

      { nombre: "Normativa contable IFRS", semestre: 3, requiere: ["Contabilidad financiera"], abre: ["Normativa contable NIC SP", "Taller de integraci贸n perfil UV I", "Contabilidad avanzada I", "Proyecto de investigaci贸n"] },
      { nombre: "Normativa tributaria", semestre: 3, requiere: ["Normativa empresarial II"], abre: ["Impuestos I", "Taller de integraci贸n perfil UV I"] },
      { nombre: "TIC para los negocios", semestre: 3, abre: ["Taller de integraci贸n perfil UV I"] },
      { nombre: "Econom铆a II", semestre: 3, requiere: ["Econom铆a I"], abre: ["Taller de integraci贸n perfil UV I"] },
      { nombre: "Estad铆stica", semestre: 3, requiere: ["Matem谩ticas II"], abre: ["Estad铆stica para los negocios", "Taller de integraci贸n perfil UV I"] },
      { nombre: "Control interno y gesti贸n de riesgos", semestre: 3, requiere: ["Introducci贸n a la auditor铆a"], abre: ["Fundamentos de auditor铆a", "Ejecuci贸n de proyectos de auditor铆a", "Auditor铆a de sistemas", "Proyecto de investigaci贸n", "Pr谩ctica temprana"] },

      { nombre: "Fundamentos de auditor铆a", semestre: 4, requiere: ["Control interno y gesti贸n de riesgos"], abre: ["Taller de integraci贸n perfil UV I"] },
      { nombre: "Normativa contable NIC SP", semestre: 4, requiere: ["Normativa contable IFRS"], abre: ["Pr谩ctica temprana"] },
      { nombre: "Impuestos I", semestre: 4, requiere: ["Normativa tributaria"], abre: ["Tributaci贸n aplicada I", "Pr谩ctica temprana"] },
      { nombre: "Costos para la toma de decisiones I", semestre: 4, requiere: ["Econom铆a I"], abre: ["Pr谩ctica temprana"] },
      { nombre: "Estad铆stica para los negocios", semestre: 4, requiere: ["Estad铆stica"], abre: ["Bases y aplicaci贸n de ciencias de datos", "Costos para la toma de decisiones II"] },
      { nombre: "Ingl茅s I", semestre: 4, abre: ["Ingl茅s II"] },

      { nombre: "Bases y aplicaci贸n de ciencias de datos", semestre: 5, requiere: ["Estad铆stica para los negocios"], abre: ["Ejecuci贸n de proyectos de auditor铆a"] },
      { nombre: "Tributaci贸n aplicada I", semestre: 5, requiere: ["Impuestos I"], abre: ["Impuestos II"] },
      { nombre: "Gesti贸n de capital humano", semestre: 5, requiere: ["Gesti贸n de organizaciones II"] },
      { nombre: "Costos para la toma de decisiones II", semestre: 5, requiere: ["Estad铆stica para los negocios"], abre: ["Introducci贸n a las finanzas", "Gesti贸n de operaciones"] },
      { nombre: "Ingl茅s II", semestre: 5, requiere: ["Ingl茅s I"], abre: ["Ingl茅s III"] },
      { nombre: "Taller de integraci贸n perfil UV I", semestre: 5, requiere: ["Normativa contable IFRS", "Normativa tributaria", "TIC para los negocios", "Econom铆a II", "Estad铆stica", "Fundamentos de auditor铆a"], abre: ["Taller de integraci贸n perfil UV II"] },

      { nombre: "Contabilidad avanzada I", semestre: 6, requiere: ["Normativa contable IFRS"], abre: ["Contabilidad avanzada II"] },
      { nombre: "Impuestos II", semestre: 6, requiere: ["Tributaci贸n aplicada I"], abre: ["Tributaci贸n aplicada II", "Proyecto de investigaci贸n"] },
      { nombre: "Gesti贸n comercial", semestre: 6, requiere: ["Gesti贸n de organizaciones II"], abre: ["Gesti贸n de operaciones"] },
      { nombre: "Introducci贸n a las finanzas", semestre: 6, requiere: ["Costos para la toma de decisiones II"], abre: ["Finanzas corporativas", "Proyecto de investigaci贸n", "Gesti贸n financiera"] },
      { nombre: "Ingl茅s III", semestre: 6, requiere: ["Ingl茅s II"], abre: ["Ingl茅s IV"] },
      { nombre: "Taller de integraci贸n perfil UV II", semestre: 6, requiere: ["Taller de integraci贸n perfil UV I"] },
      { nombre: "Ejecuci贸n de proyectos de auditor铆a", semestre: 6, requiere: ["Bases y aplicaci贸n de ciencias de datos", "Control interno y gesti贸n de riesgos"] },

      { nombre: "Contabilidad avanzada II", semestre: 7, requiere: ["Contabilidad avanzada I"], abre: ["Contabilidad avanzada III", "Auditor铆a de estados financieros", "Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial", "Pr谩ctica profesional"] },
      { nombre: "Tributaci贸n aplicada II", semestre: 7, requiere: ["Impuestos II"], abre: ["Gesti贸n tributaria", "Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial", "Pr谩ctica profesional"] },
      { nombre: "Gesti贸n de operaciones", semestre: 7, requiere: ["Gesti贸n comercial", "Costos para la toma de decisiones II"], abre: ["Planificaci贸n y control de gesti贸n", "Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial"] },
      { nombre: "Auditor铆a de sistemas", semestre: 7, requiere: ["Control interno y gesti贸n de riesgos"], abre: ["Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial"] },
      { nombre: "Finanzas corporativas", semestre: 7, requiere: ["Introducci贸n a las finanzas"], abre: ["Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Formulaci贸n y evaluaci贸n de proyectos de inversi贸n", "Direcci贸n gerencial"] },
      { nombre: "Ingl茅s IV", semestre: 7, requiere: ["Ingl茅s III"], abre: ["Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial"] },
      { nombre: "Proyecto de investigaci贸n", semestre: 7, requiere: ["Normativa contable IFRS", "Control interno y gesti贸n de riesgos", "Impuestos II", "Introducci贸n a las finanzas"], abre: ["Investigaci贸n aplicada", "Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial"] },
      { nombre: "Pr谩ctica temprana", semestre: 7, requiere: ["Normativa contable NIC SP", "Impuestos I", "Costos para la toma de decisiones I", "Control interno y gesti贸n de riesgos"], abre: ["Electivo 1 profesional", "Electivo 2 profesional", "Electivo 3 profesional", "Direcci贸n gerencial", "Pr谩ctica profesional"] },

      { nombre: "Contabilidad avanzada III", semestre: 8, requiere: ["Contabilidad avanzada II"], abre: ["Taller de integraci贸n profesional"] },
      { nombre: "Gesti贸n tributaria", semestre: 8, requiere: ["Tributaci贸n aplicada II"], abre: ["Taller de integraci贸n profesional"] },
      { nombre: "Planificaci贸n y control de gesti贸n", semestre: 8, requiere: ["Gesti贸n de operaciones"], abre: ["Taller de integraci贸n profesional"] },
      { nombre: "Auditor铆a de estados financieros", semestre: 8, requiere: ["Contabilidad avanzada II"], abre: ["Pr谩ctica profesional", "Taller de integraci贸n profesional"] },
      { nombre: "Gesti贸n financiera", semestre: 8, requiere: ["Introducci贸n a las finanzas"], abre: ["Taller de integraci贸n profesional"] },
      { nombre: "Investigaci贸n aplicada", semestre: 8, requiere: ["Proyecto de investigaci贸n"], abre: ["Taller de integraci贸n profesional"] },

      { nombre: "Electivo 1 profesional", semestre: 9 },
      { nombre: "Electivo 2 profesional", semestre: 9 },
      { nombre: "Electivo 3 profesional", semestre: 9 },
      { nombre: "Formulaci贸n y evaluaci贸n de proyectos de inversi贸n", semestre: 9, requiere: ["Finanzas corporativas"] },
      { nombre: "Direcci贸n gerencial", semestre: 9 },
      { nombre: "Pr谩ctica profesional", semestre: 9 },

      { nombre: "Taller de integraci贸n profesional", semestre: 10 }
    ];

    const contenedor = document.getElementById("contenedor");
    let estados = JSON.parse(localStorage.getItem("estadoRamos") || '{}');

    function actualizarLocalStorage() {
      localStorage.setItem("estadoRamos", JSON.stringify(estados));
    }

    // Eval煤a nota y retorna estado string para clases CSS
    function evaluar(nota) {
      if (nota === "") return "";
      const n = parseFloat(nota);
      if (n < 4.0) return "reprobado";
      if (n >= 5.0) return "eximido";
      return "examen";
    }

    // Devuelve true si se aprueban requisitos para este ramo
    function cumpleRequisitos(ramo) {
      if (!ramo.requiere || ramo.requiere.length === 0) return true;
      return ramo.requiere.every(req => {
        const notaReq = parseFloat(estados[req]);
        return notaReq >= 4.0;
      });
    }

    // Actualiza nota y rerenderiza
    function actualizarEstado(nombre, nota) {
      estados[nombre] = nota;
      actualizarLocalStorage();
      render();
    }

    // Renderiza toda la malla
    function render() {
      contenedor.innerHTML = "";

      for (let s = 1; s <= 10; s++) {
        const semestre = document.createElement("div");
        semestre.classList.add("semestre");

        // Sticker lindo por semestre (cambia icono para variedad)
        const stickers = ["","","","","","","","","",""];
        const stickerSpan = document.createElement("span");
        stickerSpan.classList.add("sticker");
        stickerSpan.textContent = stickers[s - 1];
        semestre.appendChild(stickerSpan);

        const titulo = document.createElement("h2");
        titulo.textContent = `Semestre ${s}`;
        semestre.appendChild(titulo);

        ramos.filter(r => r.semestre === s).forEach(ramo => {
          const div = document.createElement("div");
          div.classList.add("ramo");

          const nota = estados[ramo.nombre] || "";
          const estado = evaluar(nota);

          if (estado) div.classList.add(estado);

          // Bloquear si no cumple requisitos o est谩 reprobado o sin nota
          const habilitado = cumpleRequisitos(ramo) && (nota === "" || estado !== "reprobado");

          if (!habilitado) {
            div.classList.add("bloqueado");
          }

          // No tachar aunque tenga nota
          if (nota !== "" && estado !== "reprobado") {
            div.classList.add("cursado");
          }

          const label = document.createElement("label");
          label.textContent = ramo.nombre;

          const input = document.createElement("input");
          input.type = "number";
          input.min = "1";
          input.max = "7";
          input.step = "0.1";
          input.value = nota;
          input.disabled = !habilitado;

          input.addEventListener("change", () => {
            actualizarEstado(ramo.nombre, input.value);
          });

          // Mostrar estado textual al lado del input
          const estadoSpan = document.createElement("span");
          estadoSpan.classList.add("estado");
          if (estado === "reprobado") estadoSpan.textContent = "Reprobado";
          else if (estado === "examen") estadoSpan.textContent = "Examen";
          else if (estado === "eximido") estadoSpan.textContent = "Eximido";
          else if (nota !== "") estadoSpan.textContent = "Aprobado";
          else estadoSpan.textContent = "";

          div.appendChild(label);
          div.appendChild(input);
          div.appendChild(estadoSpan);

          semestre.appendChild(div);
        });

        contenedor.appendChild(semestre);
      }
    }

    render();
  </script>
</body>
</html>
