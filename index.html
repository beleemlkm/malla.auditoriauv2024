<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>📚 Malla Curricular Auditoría UV 🐱🌸</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0; padding: 20px;
      background-color: #e6d9f7;
      background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
      color: #333;
      overflow-x: auto;
      user-select: none;
    }
    h1 {
      text-align: center;
      color: #6a0dad;
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 1.5rem;
      user-select: text;
    }
    .container {
      display: flex;
      gap: 1.4rem;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding-bottom: 20px;
    }
    .semester {
      background: #fff0f6;
      border-radius: 15px;
      box-shadow: 0 5px 12px rgba(106, 13, 173, 0.2);
      min-width: 260px;
      padding: 1rem 1.2rem;
      flex-shrink: 0;
      border: 2px solid transparent;
      transition: border-color 0.3s ease;
    }
    .semester:nth-child(2) {
      background: #d9f2e6;
      box-shadow: 0 5px 12px rgba(143, 199, 123, 0.3);
    }
    .semester:nth-child(3) {
      background: #d6e7fa;
      box-shadow: 0 5px 12px rgba(161, 207, 255, 0.3);
    }
    .semester:nth-child(4) {
      background: #f7e5fc;
      box-shadow: 0 5px 12px rgba(215, 187, 251, 0.3);
    }
    .semester:nth-child(5) { background: #fff0f6; box-shadow: 0 5px 12px rgba(106, 13, 173, 0.2);}
    .semester:nth-child(6) { background: #d9f2e6; box-shadow: 0 5px 12px rgba(143, 199, 123, 0.3);}
    .semester:nth-child(7) { background: #d6e7fa; box-shadow: 0 5px 12px rgba(161, 207, 255, 0.3);}
    .semester:nth-child(8) { background: #f7e5fc; box-shadow: 0 5px 12px rgba(215, 187, 251, 0.3);}
    .semester:nth-child(9) { background: #fff0f6; box-shadow: 0 5px 12px rgba(106, 13, 173, 0.2);}
    .semester:nth-child(10){ background: #d9f2e6; box-shadow: 0 5px 12px rgba(143, 199, 123, 0.3);}

    .semester h2 {
      text-align: center;
      margin-bottom: 1rem;
      color: #6a0dad;
      font-weight: 700;
      font-size: 1.3rem;
      user-select: text;
    }
    .course {
      background: #fff;
      border-radius: 12px;
      margin-bottom: 0.8rem;
      padding: 0.6rem 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 7px rgba(0,0,0,0.05);
      transition: background-color 0.3s ease, color 0.3s ease;
      cursor: pointer;
      user-select: none;
    }
    .course.locked {
      background: #e1dff4;
      color: #9c9c9c;
      cursor: not-allowed;
      pointer-events: none;
      box-shadow: none;
    }
    .course input[type="number"] {
      width: 50px;
      padding: 3px 6px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      transition: border-color 0.3s ease;
      user-select: text;
    }
    .course input[type="number"]:focus {
      outline: none;
      border-color: #6a0dad;
      box-shadow: 0 0 5px #6a0dadaa;
    }
    .course.approved {
      background-color: #c8e6c9;
      border: 2px solid #4caf50;
      color: #2e7d32;
    }
    .course.exam {
      background-color: #fff9c4;
      border: 2px solid #fbc02d;
      color: #a77b00;
    }
    .course.reprobado {
      background-color: #ffcdd2;
      border: 2px solid #e53935;
      color: #b71c1c;
    }
    .course span.icon {
      margin-right: 8px;
      font-size: 1.15rem;
      user-select: none;
    }
    .course:not(.locked):hover {
      background-color: #dcd3f9;
    }
  </style>
</head>
<body>
  <h1>📚 Malla Curricular Auditoría UV 🐱🌸</h1>
  <div class="container" id="mallaContainer"></div>

  <script>
    const malla = {
      '1er Semestre': [
        { nombre: 'Introducción a la contabilidad', abre: ['Contabilidad financiera'] },
        { nombre: 'Normativa empresarial I', abre: ['Normativa empresarial II'] },
        { nombre: 'Gestión de organizaciones I', abre: ['Gestión de organizaciones II'] },
        { nombre: 'Lengua materna y autorregulación' },
        { nombre: 'Matemáticas I', abre: ['Matemáticas II', 'Economía I'] }
      ],
      '2do Semestre': [
        { nombre: 'Contabilidad financiera', requiere: ['Introducción a la contabilidad'], abre: ['Normativa contable IFRS'] },
        { nombre: 'Normativa empresarial II', requiere: ['Normativa empresarial I'], abre: ['Normativa tributaria'] },
        { nombre: 'Gestión de organizaciones II', requiere: ['Gestión de organizaciones I'], abre: ['Gestión de capital humano', 'Gestión comercial'] },
        { nombre: 'Introducción a la auditoría', abre: ['Control interno y gestión de riesgos'] },
        { nombre: 'Economía I', requiere: ['Matemáticas I'], abre: ['Economía II', 'Costos para la toma de decisiones I'] },
        { nombre: 'Matemáticas II', requiere: ['Matemáticas I'], abre: ['Estadística'] }
      ],
      '3er Semestre': [
        { nombre: 'Normativa contable IFRS', requiere: ['Contabilidad financiera'], abre: ['Normativa contable NIC SP', 'Taller de integración perfil UV I', 'Contabilidad avanzada I', 'Proyecto de investigación'] },
        { nombre: 'Normativa tributaria', requiere: ['Normativa empresarial II'], abre: ['Impuestos I', 'Taller de integración perfil UV I'] },
        { nombre: 'TIC para los negocios', abre: ['Taller de integración perfil UV I'] },
        { nombre: 'Economía II', requiere: ['Economía I'], abre: ['Taller de integración perfil UV I'] },
        { nombre: 'Estadística', requiere: ['Matemáticas II'], abre: ['Estadística para los negocios', 'Taller de integración perfil UV I'] },
        { nombre: 'Control interno y gestión de riesgos', requiere: ['Introducción a la auditoría'], abre: ['Fundamentos de auditoría', 'Ejecución de proyectos de auditoría', 'Auditoría de sistemas', 'Proyecto de investigación', 'Práctica temprana'] }
      ],
      '4to Semestre': [
        { nombre: 'Fundamentos de auditoría', requiere: ['Control interno y gestión de riesgos'], abre: ['Taller de integración perfil UV I'] },
        { nombre: 'Normativa contable NIC SP', requiere: ['Normativa contable IFRS'], abre: ['Práctica temprana'] },
        { nombre: 'Impuestos I', requiere: ['Normativa tributaria'], abre: ['Tributación aplicada I', 'Práctica temprana'] },
        { nombre: 'Costos para la toma de decisiones I', requiere: ['Economía I'], abre: ['Práctica temprana'] },
        { nombre: 'Estadística para los negocios', requiere: ['Estadística'], abre: ['Bases y aplicación de ciencias de datos', 'Costos para la toma de decisiones II'] },
        { nombre: 'Inglés I', abre: ['Inglés II'] }
      ],
      '5to Semestre': [
        { nombre: 'Bases y aplicación de ciencias de datos', requiere: ['Estadística para los negocios'], abre: ['Ejecución de proyectos de auditoría'] },
        { nombre: 'Tributación aplicada I', requiere: ['Impuestos I'], abre: ['Impuestos II'] },
        { nombre: 'Gestión de capital humano', requiere: ['Gestión de organizaciones II'] },
        { nombre: 'Costos para la toma de decisiones II', requiere: ['Estadística para los negocios'], abre: ['Introducción a las finanzas', 'Gestión de operaciones'] },
        { nombre: 'Inglés II', requiere: ['Inglés I'], abre: ['Inglés III'] },
        { nombre: 'Taller de integración perfil UV I', requiere: ['Normativa contable IFRS', 'Normativa tributaria', 'TIC para los negocios', 'Economía II', 'Estadística', 'Fundamentos de auditoría'], abre: ['Taller de integración perfil UV II'] }
      ],
      '6to Semestre': [
        { nombre: 'Contabilidad avanzada I', requiere: ['Normativa contable IFRS'], abre: ['Contabilidad avanzada II'] },
        { nombre: 'Impuestos II', requiere: ['Tributación aplicada I'], abre: ['Tributación aplicada II', 'Proyecto de investigación'] },
        { nombre: 'Gestión comercial', requiere: ['Gestión de organizaciones II'], abre: ['Gestión de operaciones'] },
        { nombre: 'Introducción a las finanzas', requiere: ['Costos para la toma de decisiones II'], abre: ['Finanzas corporativas', 'Proyecto de investigación', 'Gestión financiera'] },
        { nombre: 'Inglés III', requiere: ['Inglés II'], abre: ['Inglés IV'] },
        { nombre: 'Taller de integración perfil UV II', requiere: ['Taller de integración perfil UV I'] },
        { nombre: 'Ejecución de proyectos de auditoría', requiere: ['Bases y aplicación de ciencias de datos', 'Control interno y gestión de riesgos'] }
      ],
      '7mo Semestre': [
        { nombre: 'Contabilidad avanzada II', requiere: ['Contabilidad avanzada I'], abre: ['Contabilidad avanzada III', 'Auditoría de estados financieros', 'Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial', 'Práctica profesional'] },
        { nombre: 'Tributación aplicada II', requiere: ['Impuestos II'], abre: ['Gestión tributaria', 'Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial', 'Práctica profesional'] },
        { nombre: 'Gestión de operaciones', requiere: ['Gestión comercial', 'Costos para la toma de decisiones II'], abre: ['Planificación y control de gestión', 'Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial'] },
        { nombre: 'Auditoría de sistemas', requiere: ['Control interno y gestión de riesgos'], abre: ['Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial'] },
        { nombre: 'Finanzas corporativas', requiere: ['Introducción a las finanzas'], abre: ['Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Formulación y evaluación de proyectos de inversión', 'Dirección gerencial'] },
        { nombre: 'Inglés IV', requiere: ['Inglés III'], abre: ['Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial'] },
        { nombre: 'Proyecto de investigación', requiere: ['Normativa contable IFRS', 'Control interno y gestión de riesgos', 'Impuestos II', 'Introducción a las finanzas'], abre: ['Investigación aplicada', 'Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial'] },
        { nombre: 'Práctica temprana', requiere: ['Normativa contable NIC SP', 'Impuestos I', 'Costos para la toma de decisiones I', 'Control interno y gestión de riesgos'], abre: ['Electivo 1 profesional', 'Electivo 2 profesional', 'Electivo 3 profesional', 'Dirección gerencial', 'Práctica profesional'] }
      ],
      '8vo Semestre': [
        { nombre: 'Contabilidad avanzada III', requiere: ['Contabilidad avanzada II'], abre: ['Taller de integración profesional'] },
        { nombre: 'Gestión tributaria', requiere: ['Tributación aplicada II'], abre: ['Taller de integración profesional'] },
        { nombre: 'Planificación y control de gestión', requiere: ['Gestión de operaciones'], abre: ['Taller de integración profesional'] },
        { nombre: 'Auditoría de estados financieros', requiere: ['Contabilidad avanzada II'], abre: ['Práctica profesional', 'Taller de integración profesional'] },
        { nombre: 'Gestión financiera', requiere: ['Introducción a las finanzas'], abre: ['Taller de integración profesional'] },
        { nombre: 'Investigación aplicada', requiere: ['Proyecto de investigación'], abre: ['Taller de integración profesional'] }
      ],
      '9no Semestre': [
        { nombre: 'Electivo 1 profesional' },
        { nombre: 'Electivo 2 profesional' },
        { nombre: 'Electivo 3 profesional' },
        { nombre: 'Formulación y evaluación de proyectos de inversión', requiere: ['Finanzas corporativas'] },
        { nombre: 'Dirección gerencial' },
        { nombre: 'Práctica profesional' }
      ],
      '10mo Semestre': [
        { nombre: 'Taller de integración profesional' }
      ]
    };

    // Carga o inicia notas vacías
    let notas = JSON.parse(localStorage.getItem('notas')) || {};

    const container = document.getElementById('mallaContainer');

    function evaluarEstado(nota) {
      if (nota === '' || nota == null) return '';
      if (nota < 4.0) return 'reprobado';
      if (nota >= 5.0) return 'approved';
      return 'exam';
    }

    function puedeDesbloquear(curso) {
      if (!curso.requiere) return true;
      for (const req of curso.requiere) {
        const notaReq = notas[req];
        if (notaReq === undefined || notaReq < 4.0) return false;
      }
      return true;
    }

    function crearCurso(curso) {
      const div = document.createElement('div');
      div.classList.add('course');
      div.dataset.nombre = curso.nombre;

      const icon = document.createElement('span');
      icon.className = 'icon';
      icon.textContent = '📖';
      div.appendChild(icon);

      const texto = document.createElement('span');
      texto.textContent = curso.nombre;
      div.appendChild(texto);

      const input = document.createElement('input');
      input.type = 'number';
      input.min = 1;
      input.max = 7;
      input.step = 0.1;
      input.value = notas[curso.nombre] || '';
      input.title = 'Ingrese nota (1.0 a 7.0)';
      div.appendChild(input);

      input.addEventListener('input', () => {
        const val = parseFloat(input.value);
        if (!isNaN(val)) {
          notas[curso.nombre] = val;
        } else {
          delete notas[curso.nombre];
        }
        localStorage.setItem('notas', JSON.stringify(notas));
        actualizarEstado();
      });

      return div;
    }

    function actualizarEstado() {
      container.querySelectorAll('.course').forEach(c => {
        c.classList.remove('approved', 'exam', 'reprobado', 'locked');
        const nombre = c.dataset.nombre;
        const nota = notas[nombre];
        const estado = evaluarEstado(nota);
        if (estado) c.classList.add(estado);

        // Bloquear si no cumple requisitos o está reprobado o sin nota en prereqs
        const curso = buscarCursoPorNombre(nombre);
        if (!puedeDesbloquear(curso) || estado === 'reprobado' || nota === undefined) {
          c.classList.add('locked');
          c.querySelector('input').disabled = true;
        } else {
          c.querySelector('input').disabled = false;
        }
      });
    }

    // Busca el curso en la malla para un nombre dado
    function buscarCursoPorNombre(nombre) {
      for (const semestre in malla) {
        for (const curso of malla[semestre]) {
          if (curso.nombre === nombre) return curso;
        }
      }
      return null;
    }

    // Renderizar la malla completa
    function renderizarMalla() {
      container.innerHTML = '';
      for (const semestre in malla) {
        const divSem = document.createElement('div');
        divSem.classList.add('semester');
        const h2 = document.createElement('h2');
        h2.textContent = semestre;
        divSem.appendChild(h2);

        for (const curso of malla[semestre]) {
          const cursoDiv = crearCurso(curso);
          divSem.appendChild(cursoDiv);
        }
        container.appendChild(divSem);
      }
      actualizarEstado();
    }

    renderizarMalla();
  </script>
</body>
</html>
